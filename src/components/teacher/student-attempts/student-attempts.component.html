<div class="container py-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div
          class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
        >
          <h2 class="h4 mb-0">Student Exam Attempts</h2>
          <a routerLink="/teacher" class="btn btn-light btn-sm">
            <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
          </a>
        </div>

        <!-- Error Message -->
        <div class="alert alert-danger m-3" *ngIf="error">
          <i class="fas fa-exclamation-circle me-2"></i>{{ error }}
        </div>

        <!-- Loading Spinner -->
        <div class="text-center py-5" *ngIf="loading">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2 text-muted">Loading attempt data...</p>
        </div>

        <!-- Content -->
        <div class="card-body" *ngIf="!loading && !error">
          <!-- Filters -->
          <div class="row mb-4">
            <div class="col-md-3 mb-3">
              <label for="examFilter" class="form-label">Filter by Exam</label>
              <select
                id="examFilter"
                class="form-select"
                [(ngModel)]="selectedExam"
                (change)="applyFilters()"
              >
                <option value="">All Exams</option>
                <option *ngFor="let exam of exams" [value]="exam._id">
                  {{ exam.title }}
                </option>
              </select>
            </div>

            <div class="col-md-3 mb-3">
              <label for="statusFilter" class="form-label"
                >Filter by Status</label
              >
              <select
                id="statusFilter"
                class="form-select"
                [(ngModel)]="selectedStatus"
                (change)="applyFilters()"
              >
                <option value="">All Statuses</option>
                <option value="passed">Passed</option>
                <option value="failed">Failed</option>
              </select>
            </div>

            <div class="col-md-4 mb-3">
              <label for="searchFilter" class="form-label"
                >Search by Student</label
              >
              <input
                type="text"
                id="searchFilter"
                class="form-control"
                [(ngModel)]="searchTerm"
                (input)="applyFilters()"
                placeholder="Type student name..."
              />
            </div>

            <div class="col-md-2 mb-3 d-flex align-items-end">
              <button
                class="btn btn-outline-secondary w-100"
                (click)="resetFilters()"
              >
                <i class="fas fa-undo me-1"></i> Reset
              </button>
            </div>
          </div>

          <!-- Results Summary -->
          <div
            class="alert alert-info mb-4"
            *ngIf="filteredAttempts.length > 0"
          >
            Showing {{ filteredAttempts.length }} of {{ attempts.length }} total
            attempts
          </div>

          <div
            class="alert alert-warning mb-4"
            *ngIf="filteredAttempts.length === 0 && attempts.length > 0"
          >
            <i class="fas fa-info-circle me-2"></i> No attempts match your
            filter criteria
          </div>

          <!-- Attempts Table -->
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Student</th>
                  <th>Exam</th>
                  <th>Date</th>
                  <th>Score</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="attempts.length === 0">
                  <td colspan="5" class="text-center py-4 text-muted">
                    <i class="fas fa-info-circle me-2"></i>No exam attempts
                    recorded yet.
                  </td>
                </tr>
                <tr *ngFor="let attempt of filteredAttempts">
                  <td>{{ getStudentName(attempt.userId) }}</td>
                  <td>{{ getExamTitle(attempt.examId) }}</td>
                  <td>
                    {{ formatDate(attempt.endTime || attempt.startTime) }}
                  </td>
                  <td>
                    {{ attempt.score }} / {{ attempt.totalPoints }} ({{
                      (attempt.score / attempt.totalPoints) * 100
                        | number : "1.0-0"
                    }}%)
                  </td>
                  <td>
                    <span
                      class="badge"
                      [ngClass]="{
                        'bg-success': attempt.passed,
                        'bg-danger': !attempt.passed
                      }"
                    >
                      {{ attempt.passed ? "PASSED" : "FAILED" }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
