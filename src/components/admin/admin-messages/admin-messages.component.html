<div class="admin-messages">
  <div class="admin-header">
    <h2><i class="fas fa-envelope"></i> Contact Messages</h2>
    <p class="admin-subtitle">Manage and respond to contact form submissions</p>
  </div>

  <div class="filter-section">
    <div class="status-filters">
      <button
        class="filter-btn"
        [ngClass]="{ active: statusFilter === '' }"
        (click)="applyFilter('')"
      >
        <i class="fas fa-list"></i> All Messages
      </button>
      <button
        class="filter-btn"
        [ngClass]="{ active: statusFilter === 'new' }"
        (click)="applyFilter('new')"
      >
        <i class="fas fa-exclamation-circle"></i> New
      </button>
      <button
        class="filter-btn"
        [ngClass]="{ active: statusFilter === 'in-progress' }"
        (click)="applyFilter('in-progress')"
      >
        <i class="fas fa-spinner"></i> In Progress
      </button>
      <button
        class="filter-btn"
        [ngClass]="{ active: statusFilter === 'resolved' }"
        (click)="applyFilter('resolved')"
      >
        <i class="fas fa-check-circle"></i> Resolved
      </button>
    </div>
  </div>

  @if (loading) {
  <div class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading messages...</p>
  </div>
  } @else if (error) {
  <div class="error-message alert alert-danger">
    <p><i class="fas fa-exclamation-triangle"></i> {{ error }}</p>
    <button class="btn btn-primary" (click)="loadMessages()">
      <i class="fas fa-sync-alt"></i> Try Again
    </button>
  </div>
  } @else if (filteredMessages.length === 0) {
  <div class="no-messages">
    <p><i class="far fa-envelope-open"></i> No messages found.</p>
    @if (statusFilter) {
    <button class="btn btn-secondary" (click)="applyFilter('')">
      <i class="fas fa-eye"></i> Show All Messages
    </button>
    }
  </div>
  } @else {
  <div class="messages-container">
    <table class="messages-table">
      <thead>
        <tr>
          <th><i class="fas fa-user"></i> Name</th>
          <th><i class="fas fa-envelope"></i> Email</th>
          <th><i class="fas fa-tag"></i> Subject</th>
          <th><i class="fas fa-calendar-alt"></i> Date</th>
          <th><i class="fas fa-info-circle"></i> Status</th>
          <th><i class="fas fa-cog"></i> Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (message of filteredMessages; track message._id) {
        <tr
          [ngClass]="{
            'message-row': true,
            'new-message': message.status === 'new',
            'in-progress-message': message.status === 'in-progress',
            'resolved-message': message.status === 'resolved'
          }"
          (click)="viewMessage(message)"
        >
          <td>{{ message.name }}</td>
          <td>{{ message.email }}</td>
          <td>{{ message.subject }}</td>
          <td>{{ formatDate(message.createdAt) }}</td>
          <td>
            <span class="status-badge {{ message.status }}">
              <i
                class="fas {{
                  message.status === 'new'
                    ? 'fa-exclamation-circle'
                    : message.status === 'in-progress'
                    ? 'fa-spinner'
                    : 'fa-check-circle'
                }}"
              ></i>
              {{ message.status }}
            </span>
          </td>
          <td class="actions">
            <button
              class="action-btn view-btn"
              (click)="viewMessage(message); $event.stopPropagation()"
              title="View Details"
            >
              <i class="fas fa-eye"></i>
            </button>
            <button
              class="action-btn delete-btn"
              (click)="deleteMessage(message); $event.stopPropagation()"
              title="Delete Message"
            >
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  } @if (selectedMessage) {
  <div class="message-modal">
    <div class="message-modal-content">
      <div class="message-modal-header">
        <h3><i class="fas fa-envelope-open-text"></i> Message Details</h3>
        <button class="close-btn" (click)="closeMessage()" title="Close">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="message-modal-body">
        <div class="message-detail">
          <span class="detail-label"><i class="fas fa-user"></i> From:</span>
          <span>{{ selectedMessage.name }} ({{ selectedMessage.email }})</span>
        </div>
        <div class="message-detail">
          <span class="detail-label"><i class="fas fa-tag"></i> Subject:</span>
          <span>{{ selectedMessage.subject }}</span>
        </div>
        <div class="message-detail">
          <span class="detail-label"
            ><i class="fas fa-calendar-alt"></i> Date:</span
          >
          <span>{{ formatDate(selectedMessage.createdAt) }}</span>
        </div>
        <div class="message-detail">
          <span class="detail-label"
            ><i class="fas fa-info-circle"></i> Status:</span
          >
          <div class="status-dropdown">
            <select
              [ngModel]="selectedMessage.status"
              (ngModelChange)="updateStatus(selectedMessage, $event)"
              class="status-select"
            >
              <option value="new">
                <i class="fas fa-exclamation-circle"></i> New
              </option>
              <option value="in-progress">
                <i class="fas fa-spinner"></i> In Progress
              </option>
              <option value="resolved">
                <i class="fas fa-check-circle"></i> Resolved
              </option>
            </select>
          </div>
        </div>
        <div class="message-content">
          <h4><i class="fas fa-align-left"></i> Message Content:</h4>
          <p>{{ selectedMessage.message }}</p>
        </div>
      </div>

      <div class="message-modal-footer">
        <button class="btn btn-secondary" (click)="closeMessage()">
          <i class="fas fa-times"></i> Close
        </button>
        <a
          href="mailto:{{ selectedMessage.email }}?subject=Re: {{
            selectedMessage.subject
          }}"
          class="btn btn-primary"
        >
          <i class="fas fa-reply"></i> Reply by Email
        </a>
      </div>
    </div>
  </div>
  }
</div>
